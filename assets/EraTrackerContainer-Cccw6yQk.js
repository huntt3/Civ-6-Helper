import{j as s,b as ce,a as w,r as o,C as le}from"./Footer-mDVGmihs.js";const ie=({open:t,title:r,description:a,minEra:n,maxEra:u,onClose:l})=>{const d=g=>{g||l()};return s.jsx(ce,{open:t,setOpen:d,title:r,message:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"mb-2",children:a}),(n!=null||u!=null)&&s.jsxs("div",{className:"text-base text-gray-600 mb-2",children:[n," - ",u]})]}),confirmText:"Close",onConfirm:()=>{}})};var X={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},G=w.createContext&&w.createContext(X),ue=["attr","size","title"];function de(t,r){if(t==null)return{};var a=me(t,r),n,u;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(u=0;u<l.length;u++)n=l[u],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}function me(t,r){if(t==null)return{};var a={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(r.indexOf(n)>=0)continue;a[n]=t[n]}return a}function F(){return F=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},F.apply(this,arguments)}function U(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),a.push.apply(a,n)}return a}function A(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?U(Object(a),!0).forEach(function(n){fe(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):U(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}function fe(t,r,a){return r=ge(r),r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function ge(t){var r=pe(t,"string");return typeof r=="symbol"?r:r+""}function pe(t,r){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var n=a.call(t,r);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Z(t){return t&&t.map((r,a)=>w.createElement(r.tag,A({key:a},r.attr),Z(r.child)))}function he(t){return r=>w.createElement(xe,F({attr:A({},t.attr)},r),Z(t.child))}function xe(t){var r=a=>{var{attr:n,size:u,title:l}=t,d=de(t,ue),g=u||a.size||"1em",f;return a.className&&(f=a.className),t.className&&(f=(f?f+" ":"")+t.className),w.createElement("svg",F({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,n,d,{className:f,style:A(A({color:t.color||a.color},a.style),t.style),height:g,width:g,xmlns:"http://www.w3.org/2000/svg"}),l&&w.createElement("title",null,l),t.children)};return G!==void 0?w.createElement(G.Consumer,null,a=>r(a)):r(X)}function ve(t){return he({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(t)}const be=({title:t,eraScore:r,minEra:a,maxEra:n,description:u,repeatable:l,favorited:d=!1,onToggleFavorite:g,onScoreChange:f,onNextEra:b})=>{const[E,j]=o.useState(!1),N=o.useMemo(()=>`civ6-helper-eraScore-${t}-previous`,[t]),x=o.useMemo(()=>`civ6-helper-eraScore-${t}-current`,[t]),[y,v]=o.useState(()=>{const m=localStorage.getItem(N);return m!==null?parseInt(m,10):0}),[h,O]=o.useState(()=>{const m=localStorage.getItem(x);return m!==null?parseInt(m,10):0}),_=()=>j(m=>!m);o.useEffect(()=>{localStorage.setItem(N,y.toString())},[y,N]),o.useEffect(()=>{localStorage.setItem(x,h.toString())},[h,x]);const I=o.useCallback(()=>{h>0&&(v(l?m=>m+h:1),O(0))},[h,l]),k=o.useCallback(()=>{localStorage.removeItem(N),localStorage.removeItem(x),v(0),O(0)},[N,x]);o.useEffect(()=>{b&&b(t,I,k)},[t,b,I,k]),o.useEffect(()=>{f&&f(t,"previous",y*r)},[y,r,t,f]),o.useEffect(()=>{f&&f(t,"current",h*r)},[h,r,t,f]);const M=m=>{const C=m.target.value.replace(/[^0-9]/g,""),P=C===""?0:Math.max(0,parseInt(C,10));v(P)},D=m=>{const C=m.target.value.replace(/[^0-9]/g,""),P=C===""?0:Math.max(0,parseInt(C,10));O(P)},$=()=>{v(y===0?1:0)},R=()=>{O(h===0?1:0)};return s.jsxs("div",{className:"flex items-center bg-white text-black rounded-lg p-4 shadow-md border border-gray-300 gap-4 mb-2 relative",children:[s.jsx("button",{type:"button",className:"mr-2 focus:outline-none bg-transparent border-none p-0 cursor-pointer","aria-label":d?"Unfavorite":"Favorite",onClick:g,tabIndex:0,children:s.jsx(ve,{size:22,color:d?"#FFD700":"#A0AEC0","aria-hidden":"true"})}),l?s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("div",{className:"flex flex-col items-start",children:[s.jsx("label",{htmlFor:`previous-era-count-${t}`,className:"text-xs font-semibold mb-1",children:"Previous Eras"}),s.jsx("input",{id:`previous-era-count-${t}`,type:"number",min:"0",step:"1",inputMode:"numeric",pattern:"[0-9]+",value:y,onChange:M,className:"p-2 rounded-sm border border-gray-300 text-base w-24","aria-label":"Times completed in previous eras"})]}),s.jsxs("div",{className:"flex flex-col items-start",children:[s.jsx("label",{htmlFor:`current-era-count-${t}`,className:"text-xs font-semibold mb-1",children:"Current Era"}),s.jsx("input",{id:`current-era-count-${t}`,type:"number",min:"0",step:"1",inputMode:"numeric",pattern:"[0-9]+",value:h,onChange:D,className:"p-2 rounded-sm border border-gray-300 text-base w-24","aria-label":"Times completed in current era"})]})]}):s.jsxs("div",{className:"flex gap-4 items-center",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("label",{className:"text-xs font-semibold mb-1",children:"Previous Eras"}),s.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-blue-600 border-gray-400 rounded focus:ring-2 focus:ring-blue-400","aria-label":"Mark as completed in previous eras",checked:y>0,onChange:$})]}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("label",{className:"text-xs font-semibold mb-1",children:"Current Era"}),s.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-blue-600 border-gray-400 rounded focus:ring-2 focus:ring-blue-400","aria-label":"Mark as completed in current era",checked:h>0,onChange:R})]})]}),s.jsx("span",{className:"text-lg font-medium mr-2",children:t}),s.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1 mr-2 text-base",children:["+",r]}),s.jsx("button",{className:"ml-auto bg-blue-700 text-white rounded px-3 py-2 text-sm hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-400",onClick:_,"aria-label":`Show description for ${t}`,children:"Description"}),s.jsx(ie,{open:E,title:t,description:u,minEra:a,maxEra:n,onClose:_})]})},Q="civ6-helper-neededEraScore",Se=({eraScore:t=0})=>{const[r,a]=o.useState(()=>{const E=localStorage.getItem(Q);return E!==null?parseInt(E,10):18});o.useEffect(()=>{localStorage.setItem(Q,r)},[r]);const n=r>0?Math.min(t/r,1):0,u=E=>{const j=E.target.value.replace(/[^0-9]/g,"");a(j===""?0:parseInt(j,10))},l=60,d=10,g=l-d/2,f=Math.PI*g,b=f*(1-n);return s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsxs("svg",{width:l*2,height:l+d,viewBox:`0 0 ${l*2} ${l+d}`,children:[s.jsx("path",{d:`M ${d/2},${l} A ${g},${g} 0 0 1 ${l*2-d/2},${l}`,fill:"none",stroke:"#e5e7eb",strokeWidth:d}),s.jsx("path",{d:`M ${d/2},${l} A ${g},${g} 0 0 1 ${l*2-d/2},${l}`,fill:"none",stroke:"#2563eb",strokeWidth:d,strokeDasharray:f,strokeDashoffset:b,style:{transition:"stroke-dashoffset 0.5s"}})]}),s.jsxs("div",{className:"text-center mt-2",children:[s.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[t," / ",r]}),s.jsxs("div",{className:"text-sm text-gray-600",children:[Math.round(n*100),"% Complete"]})]}),s.jsx("form",{className:"flex flex-col items-center mt-4 space-y-2",children:s.jsxs("label",{className:"flex flex-col items-center",children:["Needed Era Score",s.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:r,onChange:u,className:"mt-1 p-1 border rounded w-24 text-center","aria-label":"Needed Era Score"})]})})]})},Ee=({onNextEra:t})=>s.jsx("button",{onClick:t,className:"bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-400","aria-label":"Move current era scores to previous eras",children:"Next Era"}),je=({previousEraScore:t,currentEraScore:r,onNextEra:a})=>s.jsxs("div",{className:"flex justify-center gap-8 mb-6 p-4 bg-gray-100 rounded-lg",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("label",{className:"text-sm font-semibold mb-1 text-gray-700",children:"Era Score from Previous Eras"}),s.jsx("div",{className:"text-2xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:t})]}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("label",{className:"text-sm font-semibold mb-1 text-gray-700",children:"Era Score from Current Era"}),s.jsx("div",{className:"text-2xl font-bold text-green-600 bg-white px-4 py-2 rounded border",children:r})]}),s.jsx("div",{className:"flex flex-col items-center justify-center",children:s.jsx(Ee,{onNextEra:a})})]}),J="civ6-helper-eraScore-favorites",z="civ6-helper-eraScore-sortOrder",Y="civ6-helper-eraScore-filter",W="civ6-helper-eraScore-search",B="civ6-helper-eraScore-showOnlyFavorited",q="civ6-helper-eraScore-collapsed",Ne=({settings:t})=>{const[r,a]=o.useState(()=>{const e=localStorage.getItem("civ6-helper-cardsPerPage");return e!==null?parseInt(e,10):10}),[n,u]=o.useState(0);o.useEffect(()=>{localStorage.setItem("civ6-helper-cardsPerPage",r)},[r]);const[l,d]=o.useState([]),[g,f]=o.useState(()=>{const e=localStorage.getItem(q);return e?JSON.parse(e):!0}),[b,E]=o.useState(()=>{const e=localStorage.getItem(z);return e!==null?e:"desc"}),[j,N]=o.useState(()=>{const e=localStorage.getItem(Y);return e!==null?parseInt(e,10):0}),[x,y]=o.useState(()=>{const e=localStorage.getItem(W);return e!==null?e:""}),[v,h]=o.useState(()=>{const e=localStorage.getItem(B);return e!==null?JSON.parse(e):!1}),[O,_]=o.useState(0),[I,k]=o.useState(0),[M,D]=o.useState({}),$=o.useRef({}),R=o.useRef({}),[m,C]=o.useState(()=>{try{const e=localStorage.getItem(J);return e?JSON.parse(e):[]}catch{return[]}}),[P,K]=o.useState(()=>{try{const e=localStorage.getItem("civ6_tech_state");if(!e)return[];const c=JSON.parse(e);return Object.entries(c).filter(([i,S])=>S&&S.researched).map(([i])=>String(i))}catch{return[]}});o.useEffect(()=>{localStorage.setItem(J,JSON.stringify(m))},[m]),o.useEffect(()=>{localStorage.setItem(z,b)},[b]),o.useEffect(()=>{localStorage.setItem(Y,j.toString())},[j]),o.useEffect(()=>{localStorage.setItem(W,x)},[x]),o.useEffect(()=>{localStorage.setItem(B,JSON.stringify(v))},[v]),o.useEffect(()=>{localStorage.setItem(q,JSON.stringify(g))},[g]),o.useEffect(()=>{const e=i=>{if(i.key==="civ6_tech_state")try{const S=JSON.parse(i.newValue);K(Object.entries(S).filter(([,p])=>p&&p.researched).map(([p])=>String(p)))}catch{}};window.addEventListener("storage",e);const c=setInterval(()=>{try{const i=localStorage.getItem("civ6_tech_state");if(!i)return;const S=JSON.parse(i);K(Object.entries(S).filter(([,p])=>p&&p.researched).map(([p])=>String(p)))}catch{}},1e3);return()=>{window.removeEventListener("storage",e),clearInterval(c)}},[]),o.useEffect(()=>{try{const e=localStorage.getItem("civ6_tech_state");if(!e)return;const c=JSON.parse(e);K(Object.entries(c).filter(([i,S])=>S&&S.researched).map(([i])=>i))}catch{}},[]);const H=()=>{fetch("./jsonFiles/EraScore.json").then(e=>e.json()).then(e=>d(e.EraScore||[])).catch(()=>d([]))};o.useEffect(()=>{H()},[]);const ee=()=>f(e=>!e),V=t||{heroesLegends:!1,monopoliesCorporations:!1};let T=l.map(e=>({...e,favorited:m.includes(e.title)})).filter(e=>!(!e.title||e.gameMode==="Monopolies and Corporations"&&!V.monopoliesCorporations||e.gameMode==="Heroes & Legends"&&!V.heroesLegends||j&&e.eraScore!==j||x&&!(e.title.toLowerCase().includes(x.toLowerCase())||e.description&&e.description.toLowerCase().includes(x.toLowerCase()))||v&&!e.favorited||Array.isArray(e.prerequisites)&&e.prerequisites.length>0&&!e.prerequisites.some(c=>P.map(i=>i.toLowerCase()).includes(String(c).toLowerCase()))));T=T.sort((e,c)=>b==="asc"?e.eraScore-c.eraScore:c.eraScore-e.eraScore);const L=Math.ceil(T.length/r),te=T.slice(n*r,n*r+r),re=e=>{C(c=>c.includes(e)?c.filter(i=>i!==e):[...c,e])},se=o.useCallback((e,c,i)=>{D(S=>{const p={...S};return p[e]||(p[e]={previous:0,current:0}),p[e][c]=i,p})},[]),ae=o.useCallback((e,c,i)=>{$.current[e]=c,i&&(R.current[e]=i)},[]),ne=o.useCallback(()=>{Object.values($.current).forEach(e=>{typeof e=="function"&&e()})},[]),oe=o.useCallback(()=>{Object.values(R.current).forEach(e=>{typeof e=="function"&&e()}),localStorage.removeItem("civ6-helper-neededEraScore"),localStorage.removeItem(J),localStorage.removeItem("civ6-helper-cardsPerPage"),localStorage.removeItem(z),localStorage.removeItem(Y),localStorage.removeItem(W),localStorage.removeItem(B),localStorage.removeItem(q),C([]),a(10),u(0),E("desc"),N(0),y(""),h(!1),f(!0),H()},[]);return o.useEffect(()=>{let e=0,c=0;Object.values(M).forEach(i=>{e+=i.previous||0,c+=i.current||0}),_(e),k(c)},[M]),s.jsxs(le,{title:"Era Score Tracker",collapsed:g,onCollapse:ee,onRefresh:oe,ariaLabel:"Era Tracker",children:[s.jsx(Se,{eraScore:I}),s.jsx(je,{previousEraScore:O,currentEraScore:I,onNextEra:ne}),s.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 items-center",children:[s.jsx("button",{className:`px-3 py-1 rounded ${v?"bg-yellow-400 text-white":"bg-gray-200"}`,onClick:()=>h(e=>!e),"aria-pressed":v,children:v?"Show All":"Show Favorites"}),s.jsx("button",{className:`px-3 py-1 rounded ${b==="asc"?"bg-blue-600 text-white":"bg-gray-200"}`,onClick:()=>E("asc"),children:"Sort Ascending"}),s.jsx("button",{className:`px-3 py-1 rounded ${b==="desc"?"bg-blue-600 text-white":"bg-gray-200"}`,onClick:()=>E("desc"),children:"Sort Descending"}),s.jsx("input",{type:"number",min:"0",max:"5",placeholder:"Filter by Era Score",value:j||"",onChange:e=>{let c=e.target.value===""?0:parseInt(e.target.value,10);c>5&&(c=5),N(c)},className:"p-1 border rounded w-36 text-center"}),s.jsx("input",{type:"text",placeholder:"Search by title or description",value:x,onChange:e=>y(e.target.value),className:"p-1 border rounded w-56"}),s.jsxs("label",{className:"flex items-center ml-auto",children:[s.jsx("span",{className:"mr-2",children:"Cards per page:"}),s.jsx("input",{type:"number",min:"1",max:"100",value:r,onChange:e=>{let c=e.target.value===""?1:parseInt(e.target.value,10);c<1&&(c=1),c>100&&(c=100),a(c),u(0)},className:"p-1 border rounded w-20 text-center","aria-label":"Cards per page"})]})]}),s.jsx("div",{className:"era-score-list",children:te.map(e=>s.jsx(be,{...e,favorited:e.favorited,onToggleFavorite:()=>re(e.title),onScoreChange:se,onNextEra:ae},e.title))}),s.jsxs("div",{className:"flex justify-center items-center mt-4 gap-4",children:[s.jsx("button",{onClick:()=>u(e=>Math.max(0,e-1)),disabled:n===0,className:`px-3 py-2 rounded bg-gray-200 hover:bg-gray-300 ${n===0?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Previous page",children:"←"}),s.jsxs("span",{children:["Page ",n+1," of ",L]}),s.jsx("button",{onClick:()=>u(e=>Math.min(L-1,e+1)),disabled:n>=L-1,className:`px-3 py-2 rounded bg-gray-200 hover:bg-gray-300 ${n>=L-1?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Next page",children:"→"})]})]})};export{Ne as E};
