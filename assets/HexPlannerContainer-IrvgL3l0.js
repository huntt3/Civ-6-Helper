import{r as c,a as w,j as t,C as Q}from"./Footer-mDVGmihs.js";const T="civ6-helper-hex-planner-data",Y=c.forwardRef(({onHexClick:v,radius:f=3},M)=>{const[u,j]=c.useState([]),[b,x]=c.useState([]),[h,o]=c.useState(1),[g,S]=c.useState({x:0,y:0}),[r,C]=c.useState(!1),[y,H]=c.useState({x:0,y:0}),I=w.useRef(null);w.useEffect(()=>{fetch("./jsonFiles/Tiles.json").then(e=>e.json()).then(e=>x(e.Tiles||[])).catch(()=>x([]))},[]),w.useEffect(()=>{const e=u.filter(n=>n.tile).map(n=>({id:n.id,q:n.q,r:n.r,s:n.s,tile:n.tile}));e.length>0?localStorage.setItem(T,JSON.stringify(e)):localStorage.removeItem(T)},[u]);const i=w.useCallback(()=>{try{const e=localStorage.getItem(T);return e?JSON.parse(e):[]}catch{return[]}},[]),E=e=>e.replace(/(?:^\w|[A-Z]|\b\w)/g,(n,s)=>s===0?n.toLowerCase():n.toUpperCase()).replace(/\s+/g,""),R=e=>{if(!e)return null;const n=E(e);return["cityCenter","campus","commercialHub","harbor","holySite","industrialZone","theaterSquare","encampment","aerodrome","entertainmentComplex","waterPark","neighborhood","governmentPlaza","diplomaticQuarter","preserve","aqueduct","canal","dam"].includes(n)?`./districtImg/${n}.webp`:null},X=e=>{const n=[];for(let s=-e;s<=e;s++)for(let a=-e;a<=e;a++)Math.abs(s+a)<=e&&n.push({q:s,r:a,s:-s-a,id:`${s},${a}`,tile:null});return n};w.useEffect(()=>{j(e=>{const n=X(f),s=i();return n.map(l=>{const d=s.find(p=>p.id===l.id);if(d)return{...l,tile:d.tile};const m=e.find(p=>p.id===l.id);return m?{...l,tile:m.tile}:l})})},[f,i]),w.useEffect(()=>{const e=I.current;if(!e)return;const n=s=>{s.preventDefault();const a=s.deltaY>0?.9:1.1;o(l=>Math.max(.5,Math.min(3,l*a)))};return e.addEventListener("wheel",n,{passive:!1}),()=>{e.removeEventListener("wheel",n)}},[]);const L=e=>{if(!e.tile||e.tile.type!=="district")return 0;const n=b.find(l=>l.name===e.tile.name);if(!n)return 0;const s=_(e);let a=0;return s.forEach(l=>{if(!l.tile)return;const d=l.tile.name;n.districtMinorAdjacencies?.includes(d)?a+=.5:n.normalAdjacencies?.includes(d)?a+=1:n.majorAdjacencies?.includes(d)&&(a+=2)}),a},_=e=>[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}].map(s=>{const a=e.q+s.q,l=e.r+s.r,d=`${a},${l}`;return u.find(m=>m.id===d)}).filter(Boolean),k=(e,n)=>{const s=n*(Math.sqrt(3)*e.q+Math.sqrt(3)/2*e.r),a=n*(3/2*e.r);return{x:s,y:a}},z=(e,n,s)=>{const a=[];for(let l=0;l<6;l++){const d=Math.PI/3*l+Math.PI/6,m=e+s*Math.cos(d),p=n+s*Math.sin(d);a.push(`${m},${p}`)}return`M ${a.join(" L ")} Z`},B=e=>{r||v(e.id,{q:e.q,r:e.r,s:e.s})},O=e=>{C(!1),H({x:e.clientX-g.x,y:e.clientY-g.y})},V=e=>{if(y.x!==0||y.y!==0){const n=Math.abs(e.clientX-(y.x+g.x)),s=Math.abs(e.clientY-(y.y+g.y));(n>5||s>5)&&C(!0),S({x:e.clientX-y.x,y:e.clientY-y.y})}},D=()=>{H({x:0,y:0}),setTimeout(()=>C(!1),100)},F=()=>{if(u.length===0)return{minX:0,maxX:0,minY:0,maxY:0};const e=30;let n=1/0,s=-1/0,a=1/0,l=-1/0;return u.forEach(d=>{const m=k(d,e),p=e;n=Math.min(n,m.x-p),s=Math.max(s,m.x+p),a=Math.min(a,m.y-p),l=Math.max(l,m.y+p)}),{minX:n,maxX:s,minY:a,maxY:l}},G=(e,n)=>{j(s=>s.map(a=>a.id===e?{...a,tile:n}:a))},U=()=>{j(e=>e.map(n=>({...n,tile:null}))),localStorage.removeItem(T)};c.useImperativeHandle(M,()=>({updateHexTile:G,clearHexData:U,resetView:()=>{o(1),S({x:0,y:0})}}),[]);const P=30,N=F(),q=60,J=N.maxX-N.minX+q*2,W=N.maxY-N.minY+q*2,Z=-N.minX+q,K=-N.minY+q;return t.jsx("div",{className:"w-full h-96 bg-gray-50 rounded-lg overflow-hidden cursor-grab active:cursor-grabbing",children:t.jsxs("svg",{ref:I,width:"100%",height:"100%",viewBox:`0 0 ${J} ${W}`,className:"select-none",onMouseDown:O,onMouseMove:V,onMouseUp:D,onMouseLeave:D,children:[t.jsx("defs",{children:u.filter(e=>e.tile).map(e=>{const n=R(e.tile.name);return n?t.jsx("pattern",{id:`pattern-${e.id.replace(",","-")}`,patternUnits:"objectBoundingBox",width:"1",height:"1",children:t.jsx("image",{href:n,width:"60",height:"60",x:"0",y:"0",preserveAspectRatio:"xMidYMid slice"})},`pattern-${e.id}`):null}).filter(Boolean)}),t.jsx("g",{transform:`translate(${g.x}, ${g.y}) scale(${h})`,children:t.jsx("g",{transform:`translate(${Z}, ${K})`,children:u.map(e=>{const n=k(e,P),s=n.x,a=n.y,l=z(s,a,P),d=e.tile?R(e.tile.name):null,m=L(e);return t.jsxs("g",{children:[t.jsx("path",{d:l,fill:e.tile&&d?`url(#pattern-${e.id.replace(",","-")})`:e.tile?"#10b981":"#e5e7eb",stroke:"#374151",strokeWidth:"1",className:"cursor-pointer hover:opacity-75 transition-opacity",onClick:()=>B(e)}),e.tile&&!d&&t.jsx("text",{x:s,y:a-5,textAnchor:"middle",fontSize:"8",fill:"white",fontWeight:"bold",pointerEvents:"none",children:e.tile.name.length>10?e.tile.name.substring(0,10)+"...":e.tile.name}),e.tile&&e.tile.type==="district"&&t.jsxs("g",{children:[t.jsx("rect",{x:s-15,y:a+8,width:"30",height:"14",fill:"rgba(0, 0, 0, 0.8)",rx:"2",pointerEvents:"none"}),t.jsxs("text",{x:s,y:a+18,textAnchor:"middle",fontSize:"10",fill:"gold",fontWeight:"bold",pointerEvents:"none",children:["+",m]})]}),t.jsxs("text",{x:s,y:a+(e.tile?30:5),textAnchor:"middle",fontSize:"6",fill:"#666",pointerEvents:"none",children:[e.q,",",e.r]})]},e.id)})})})]})})});Y.displayName="CustomHexGrid";const ee=({open:v,onClose:f,onTileSelect:M,selectedHex:u})=>{const[j,b]=c.useState([]),[x,h]=c.useState("all");c.useEffect(()=>{fetch("./jsonFiles/Tiles.json").then(r=>r.json()).then(r=>b(r.Tiles||[])).catch(()=>b([]))},[]);const o=r=>{u&&M(u.id,r),f()},g=j.filter(r=>x==="all"?!0:r.type===x),S=[...new Set(j.map(r=>r.type))];return t.jsx(t.Fragment,{children:v&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto",children:[t.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Select Tile Type"}),t.jsxs("p",{className:"mb-4 text-sm text-gray-600",children:["Select a tile type for hex at position (",u?.coords?.q,","," ",u?.coords?.r,"):"]}),t.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[t.jsx("button",{onClick:()=>h("all"),className:`px-3 py-1 text-xs rounded ${x==="all"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"All"}),S.map(r=>t.jsx("button",{onClick:()=>h(r),className:`px-3 py-1 text-xs rounded ${x===r?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:r},r))]}),t.jsx("div",{className:"grid grid-cols-2 gap-2 mb-4 max-h-60 overflow-y-auto",children:g.map(r=>t.jsxs("button",{onClick:()=>o(r),className:"p-3 text-left rounded border transition-colors bg-gray-50 border-gray-300 hover:bg-blue-100 hover:border-blue-500",children:[t.jsx("div",{className:"font-medium text-sm",children:r.name}),t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:r.type}),r.requirement&&t.jsxs("div",{className:"text-xs text-gray-400 mb-1",children:["Requires: ",r.requirement]}),r.appeal!==void 0&&t.jsxs("div",{className:"text-xs text-gray-600",children:["Appeal:"," ",r.appeal>0?`+${r.appeal}`:r.appeal]})]},r.name))}),t.jsx("div",{className:"flex gap-2 justify-end",children:t.jsx("button",{onClick:f,className:"px-4 py-2 text-sm bg-gray-300 rounded hover:bg-gray-400",children:"Cancel"})})]})})})},$="civ6-helper-hex-planner-grid-radius",A="civ6-helper-hex-planner-collapsed",ne=()=>{const[v,f]=c.useState(()=>{const i=localStorage.getItem(A);return i?JSON.parse(i):!0}),[M,u]=c.useState(!1),[j,b]=c.useState(null),[x,h]=c.useState(()=>{const i=localStorage.getItem($);return i?parseInt(i,10):3}),o=c.useRef(null);c.useEffect(()=>{localStorage.setItem($,x.toString())},[x]),c.useEffect(()=>{localStorage.setItem(A,JSON.stringify(v))},[v]);const g=()=>{f(i=>!i)},S=(i,E)=>{b({id:i,coords:E}),u(!0)},r=(i,E)=>{o.current&&o.current.updateHexTile&&o.current.updateHexTile(i,E)},C=()=>{u(!1),b(null)},y=i=>{h(i)},H=()=>{o.current&&o.current.resetView&&o.current.resetView(),o.current&&o.current.clearHexData&&o.current.clearHexData(),h(3),f(!0),localStorage.removeItem($),localStorage.removeItem(A),h(i=>i===3?3.1:3),setTimeout(()=>h(3),100)},I=()=>{o.current&&o.current.resetView&&o.current.resetView()};return t.jsxs(t.Fragment,{children:[t.jsx(Q,{title:"Hex Planner",collapsed:v,onCollapse:g,onRefresh:H,ariaLabel:"Hex Planner",children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Click on any hex to place a district, improvement, or feature. Districts show their adjacency bonus in gold. Use scroll wheel to zoom, drag to pan."}),t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.jsx("button",{onClick:I,className:"px-3 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Reset View"}),t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Grid Size:"}),t.jsxs("select",{value:x,onChange:i=>y(parseInt(i.target.value)),className:"px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:2,children:"Small (2)"}),t.jsx("option",{value:3,children:"Medium (3)"}),t.jsx("option",{value:4,children:"Large (4)"}),t.jsx("option",{value:5,children:"Extra Large (5)"}),t.jsx("option",{value:6,children:"Extra Large (6)"}),t.jsx("option",{value:7,children:"Huge (7)"})]})]})]}),t.jsx(Y,{ref:o,onHexClick:S,radius:x}),t.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[t.jsx("p",{children:t.jsx("strong",{children:"Adjacency Bonus Legend:"})}),t.jsx("p",{children:"• Minor adjacencies (other districts): +0.5 points"}),t.jsx("p",{children:"• Normal adjacencies (features/terrain): +1 point"}),t.jsx("p",{children:"• Major adjacencies (special features): +2 points"})]})]})}),t.jsx(ee,{open:M,onClose:C,onTileSelect:r,selectedHex:j})]})};export{ne as H};
